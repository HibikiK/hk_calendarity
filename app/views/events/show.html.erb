<h1 class='mt-3 mb-3'><%= @event.name %>

<div class='row'>
  <div class='col-md-8'>

    <div class='card mb-2'>
      <h5 class='card-header'>イベント分類</h5>
      <div class='card-body'>
        <p class='card-text fs-5'><%= I18n::t("enums.event.event_type.#{@event.event_type}") %></p>
      </div>
    </div>

    <div class='card mb-2'>
      <h5 class='card-header'>開催時間</h5>
      <div class='card-body'>
        <p class='card-text fs-5'><%= "#{l(@event.start_at, format: :long)}  -  #{l(@event.end_at, format: :long)}" %></p>
      </div>
    </div>

    <div class='card mb-2'>
      <h5 class='card-header'>開催場所</h5>
      <div class='card-body'>
        <p class='card-text fs-5'><%= @event.place %></p>
      </div>
    </div>

    <div class='card mb-2'>
      <h5 class='card-header'>イベント内容</h5>
      <div class='card-body'>
        <p class='card-text fs-5'><%= @event.definition %></p>
      </div>
    </div>

    <div class='card mb-2'>
      <h5 class='card-header'>主催者</h5>
      <div class='card-body'>
        <p class='card-text fs-5'><%= @event.owner.username %></p>
      </div>
    </div>
  </div>
  
  <div class='col-md-4'>

    <div class='card mb-2 border-0'>
      <% if @event.image.attached? %>
        <%# <%= image_tag @event.image, class: "card-img-top" %>
        <%= image_tag(@event.image.variant(resize_to_fit: [200, 200]), class:'img-thumbnail mb-3') %>
      <% end %>
    </div>

    <hr>
    <div class='card mb-2'>
      <h5 class='card-header'>参加者</h5>
      <ul class='list-group list-group-flush'>
        <% @participations.each do |participation| %>
          <li class='list-group-item fs-6'>
            <%= "@#{participation.user.username}" %>
            <%= participation.comment %>
          </li>
        <% end %>
      </ul>
    </div>

    <hr>
    <% if @participation %>
      <%= link_to "参加をキャンセルする", event_participation_path(@event, @participation), method: :delete, class:'btn btn-warning btn-lg d-grid gap2 m-1' %>
    <% elsif user_signed_in? %>
      <div class='btn btn-primary btn-lg d-grid gap2 m-1' data-bs-toggle="modal" data-bs-target="#createParticipation">参加する
      </div>

      <%# Modal %>
      <div class='modal fade' id='createParticipation'>
        <div class='modal-dialog'>
          <div class='modal-content'>

            <div class='modal-header'>
              <h5 class='modal-title' id='dialogHeader'>参加コメント</h5>
                <button class='btn-close btn-sm' type='button' data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <%= form_with(model: @event.participations.build, url: event_participations_path(@event)) do |f| %>
              <div class='modal-body'>
                <div class='fs-6' id='createParticipationErrors'></div>
                  <%= f.text_field :comment, class:'form-control py-3' %>
              </div>

              <div class='modal-footer'>
                <button class='btn btn-default' type='button' data-bs-dismiss='modal' aria-label="Close">
                  キャンセル
                  <%= f.button '送信', class:'btn btn-primary' %>
                </button>
              </div>
            <% end %>

          </div>
        </div>
      </div>

    <% else %>
      <%= link_to '参加する', new_event_participation_path(@event), class: 'btn btn-primary btn-lg d-grid gap2' %>
    <% end %>

    <% if @event.created_by?(current_user) %>
      <%= link_to "イベントを編集する", edit_event_path(@event), class:'btn btn-info btn-lg d-grid gap2 m-1' %>
      <%= link_to "イベントを削除する", event_path(@event), class:'btn btn-danger btn-lg d-grid gap2 m-1', method: :delete, data: {confirm:"本当に削除してよろしいですか？"} %>
    <% end %>
    
    
  </div>

</div>

