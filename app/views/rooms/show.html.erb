<h1>Chat Room</h1>

<section class="row">

  <div class="col-md-3 mx-3">
    <%= render 'messages/chatlinks' %>
    <br />
    <%= link_to 'Group Chat', user_rooms_path(current_user.id), class: 'btn btn-primary d-grid gap-2 border mt-1 mx-3' %>
  </div>

  <div class="col-md-8 mx-3">
    
    <h3>Chat with: <%= @partner.fullname %></h3>
    <div class='container border p-3' id='chatbox'>
      <%# 個人チャットの投稿一覧 %>
      <div id='posts'>
          <% if @messages != nil %>
            <% l = @messages.length; @messages.each_with_index do |message, i| %>
              <% if message.user_id == current_user.id %>
                <%# 自分の発言 %>
                <div class='mycomment'>
                  <div class='d-flex justify-content-end'>
                    <div class='timestamp'>
                      <%= "#{l(message.created_at, format: :short)}" %><br />
                      <%= User.find(message.user_id).fullname %>
                    </div>
                  </div>
                  <div class='d-flex justify-content-end'>
                    <div class='balloon'>
                      <blockquote class='text-white'><%= simple_format(h(message.content)) %></blockquote>
                    </div>
                  </div>
                </div>
              <% else %>
                <%# 相手の発言 %>
                <div class='partnercomment'>
                  <div class='d-flex justify-content-start'>
                    <div class='timestamp'>
                      <%= "#{l(message.created_at, format: :short)}" %><br />
                      <%= User.find(message.user_id).fullname %>
                    </div>
                  </div>
                  <div class='d-flex justify-content-start'>
                    <div class='pballoon'>
                      <blockquote class='text-dark'><%= simple_format(h(message.content)) %></blockquote>
                    </div>
                  </div>
                </div>

              <% end %>
            <% end %>
          <% end %>
          

        <div class="d-flex justify-content-end me-3">
          <%# <%= paginate @posts %>
        </div>
      </div>

      <%# チャットの投稿 %>
      <div class='card my-4 mx-1'>
        <div class='card-header bg-primary text-white text-center'>投稿</div>
          <div class='form-group'>
            <%= form_with(model: Message.new) do |f| %>
                <div class='d-flex'>
                  <div id="errors"></div>
                  <%= f.text_area :content, placeholder: "メッセージを入力してください", class:'form-control', rows: 2 %>
                  <%= f.hidden_field :user_id, { value: current_user.id } %>
                  <%= f.hidden_field :send_user_id, { value: @partner.id } %>
                  <%= f.submit '送信', class:'btn btn-info px-3 border' %>
                </div>
            <% end %>
          </div>
        </div>
      </div>
    
    </div>
  </div>

</section>